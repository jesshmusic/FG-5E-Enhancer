<?xml version="1.0" encoding="iso-8859-1"?>

<!-- 
  Author Xelab
  I have bundled all .xml changes in one file for ease of use, comments indicate where the changes should happen
-->

<root>
	<!-- overrides multiple function from scripts/manager_action_*.lua -->
	<script name="Spell_Automation" file="spell_automation.lua" />
	

	<!-- strings/strings_5e.xml -->
	<string name="spell_upcast_string">Upcast</string>
	<string name="option_label_Default_Actions">Spell Automation: Default Actions</string>
	<string name="option_label_Default_Actions_0">None</string>
	<string name="option_label_Default_Actions_1">One</string>
	<string name="option_label_Default_Actions_9">All</string>
	<string name="option_label_Actions_Hide">Spell Automation: Actions Hide</string>
	<string name="option_label_Actions_Hide_Delayed">Delayed</string>
	<string name="option_label_Actions_Hide_Instant">Instant</string>
	<string name="option_label_Cast_Message">Spell Automation: CAST Message</string>
	


	<!-- campaign/record_power.xml -->
	<windowclass name="power_item" merge="join">
		<script file="campaign/scripts/power_item_override.lua" />		
	</windowclass>
	
	<windowclass name="power_page" merge="join">
		<script file="campaign/scripts/power_page_override.lua" />
	</windowclass>
	
	<windowclass name="power_item_header" merge="join">
		<sheetdata>
			<counter_power name="counter">
				<script file="campaign/scripts/power_counter_override.lua" />	
			</counter_power>
		</sheetdata>
	</windowclass>
	
	
	
	<!-- campaign/record_char_weapon.xml -->
	<windowclass name="char_weapon" merge="join">
		<sheetdata>
			<icon_useweapon name="useweapon" insertbefore="name">
				<anchored to="leftanchor" width="20" height="20">
					<top offset="10" />
					<left anchor="right" relation="relative" offset="0" />
				</anchored>
				
				<script>
					function onButtonPress()
						Spell_Automation.action_list = {window.onDamageAction}
						window.onAttackAction();						
					end
				</script>
			</icon_useweapon>
		</sheetdata>
	</windowclass>
	
	
	
	<!-- campaign/record_char_actions.xml -->
	<windowclass name="charsheet_actions" merge="join">
		<sheetdata>
			<button_stringcycler name="powerdisplaymode">
				<anchored to="powerdisplay_label" position="righthigh" offset="10,0" width="70" />
			</button_stringcycler>
		
			<label name="spell_upcast_label">
				<anchored to="powerdisplaymode" position="righthigh" offset="15,0" />
				<static textres="spell_upcast_string" />
			</label>
			
			<basicnumber name="spell_upcast" source="upcast_level">
				<anchored to="spell_upcast_label" position="righthigh" offset="10,0" width="20" height="20" />
				<hideonvalue>0</hideonvalue>
				<description field="name" />
				<script>				
					function onClickDown()
						window.contents.subwindow.actions.subwindow.onUsesChanged();
					end
					
					function onDoubleClick()
						Spell_Automation.Upcast_double_click(window)
					end
				</script>
			</basicnumber>
			
		
			<button_iedit name="actions_iedit">
				<anchored position="insidebottomright" offset="10,10" />
				<tooltip textres="char_tooltip_actionedit" />
				<script>
					function onValueChanged()
						local bEditMode = (getValue() == 1);
						
						window.spell_upcast_label.setVisible(not bEditMode);
						window.spell_upcast.setVisible(not bEditMode);
						
						super.onValueChanged()
					end
				</script>
			</button_iedit>	
		</sheetdata>
	</windowclass>
	
	
	
	<!-- campaign/template_power.xml -->
	<template name="button_poweraction_mini">
		<button_roll>
			<bounds>1,1,20,20</bounds>
			<script>
				function action(draginfo)
					PowerManager.performPCPowerAction(draginfo, window.getDatabaseNode());
				end
				
				function onButtonPress()		
					action();
					
					local winlist = window.windowlist.getWindows()
					if winlist[#winlist] == window then
						window.windowlist.window.parentcontrol.window.windowlist.window.onUsesChanged()
					end
				end
				
				function onDragStart(button, x, y, draginfo)
					action(draginfo);
					
					local winlist = window.windowlist.getWindows()
					if winlist[#winlist] == window then
						window.windowlist.window.parentcontrol.window.windowlist.window.onUsesChanged()
					end
					
					return true;
				end
			</script>
		</button_roll>
	</template>
	
	
	
	<template name="icon_useweapon">
		<buttoncontrol>
			<anchored width="20" height="20" />
			<icon normal="power_weapon" />
		</buttoncontrol>
	</template>
	

</root>



